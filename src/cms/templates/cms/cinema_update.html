{% extends "cms/statistics.html" %}
{% load django_tables2 %}

{% block content %}



<form action="{% url 'cinema_update' cinema_form.instance.pk %}" method="post" enctype="multipart/form-data">

    {% csrf_token %}

    <div class="p-2">
            <div class=" col d-flex justify-content-end ">
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-secondary active">
                        <input type="radio" name="options" id="option1" checked> RUS
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" name="options" id="option2"> ENG
                    </label>
                </div>

        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Название кинотеатра</span>
                    </div>
                    {{ cinema_form.title }}
<!--                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">-->
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Описание</span>
                    </div>
                    {{cinema_form.description }}

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Условия</span>
                    </div>
                    {{cinema_form.conditions}}
                </div>
            </div>
        </div>


        <div class="row">
            <div  class="col-md-2">

              <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Логотип</span>
                    </div>
              </div>
            </div>


            <div class="card col-md-2" style="width: 20rem;">

                <img id="mainImagePreview" src="{{ cinema_form.instance.main_image.urls }}" class="card-img-top" alt="...">
            </div>
            <div  class="col-md-2">
                <button type="button"  id="uploadMainImage" class="btn btn-success">Загрузить</button>
            </div>
            <div  class="col-md-2">
               <button type="button" id="deleteMainImage" class="btn btn-danger">Удалить</button>
            </div>
        </div>


        <div class="row">
            <div  class="col-md-2">
              <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Фото верхнего баннера</span>
                    </div>
              </div>
            </div>
            <div class="card col-md-2" style="width: 20rem;">
                {% if cinema_form.instance.image_top_banner %}

                <img id="previewBanner" src="{{ cinema_form.instance.image_top_banner.url }}" class="card-img-top" alt="...">
                {% else %}
                <img id='previewBanner' src="https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673-960x960.png" class="card-img-top" alt="...">
                {% endif %}
            </div>

            <div  class="col-md-2 d-flex align-items-center">
                <button type="button" id="uploadBannerBtn" class="btn btn-success">Загрузить</button>
            </div>
            {{ cinema_form.image_top_banner }}

            <div  class="col-md-2 d-flex align-items-center">
               <button type="button" class="btn btn-danger">Удалить</button>
            </div>
        </div>


<!--Болки галерея картинок &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
        <div class="row">
            <div class="col-md-2">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Галерея картинок:</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-2 ">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text ">Размер: 1000х190</span>
                    </div>
                </div>
            </div>

            <div class="col-md-10">
                <div class="row">
                    {% for i in image_num %}
                    <div class="col-md-2">

                        <div  class="d-flex align-items-center ">
                            <button type="button" class="btn btn-danger w-100 ">Удалить</button>
                        </div>
                        <img id='previewBanner' src="https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673-960x960.png" class="card-img-top" alt="...">
                        <div  class="d-flex align-items-center ">
                            <button type="button" id="uploadBannerBtn" class="btn btn-success  w-100">Загрузить</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

<!--Закрыл блоки галерея картинок &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->


        <div class="text-center mt-5">
            <h1>Список залов</h1>
        </div>

        <div class="card-body ml-5">
        {% render_table hall_table %}
        </div>



        <div class="row mt-4">
            <div class="col-md-12 d-flex justify-content-center mt-5">

                <button type="submit" class="btn btn-primary">
                    Создать зал
                </button>
            </div>
        </div>


        <div class="row mt-5">
            <div class="col-md-12">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">SEO Блок:</span>
                    </div>
                    <div class="d-flex flex-column align-items-center w-100">

                        <div class="mb-2 w-50 text-center">
                            {{ seo_form.url.placeholder }}
                            <div class="mb-2 w-100 d-flex align-items-center justify-content-center">
                                <span class="me-2 mr-2 text-muted">{{ seo_form.url.label }}</span>


                                {{ seo_form.url }}
                            </div>
                        </div>

                        <div class="mb-2 w-50 text-center">
                            {{ seo_form.title.placeholder }}
                            <div class="mb-2 w-100 d-flex align-items-center justify-content-center">
                                <span class="me-2 mr-2 text-muted">{{seo_form.title.label}}</span>
                                {{ seo_form.title }}
                            </div>
                        </div>


                        <div class="mb-2 w-50 text-center">
                            {{ seo_form.key_words.placeholder }}
                            <div class="mb-2 w-100 d-flex align-items-center justify-content-center">
                                <span class="me-2 mr-2 text-muted">{{seo_form.key_words.label}}</span>
                                {{ seo_form.key_words }}
                            </div>
                        </div>


                         <div class="mb-2 w-50 text-center">
                            {{ seo_form.description.placeholder }}
                            <div class="mb-2 w-100 d-flex align-items-center justify-content-center">
                                <span class="me-2 mr-2 text-muted">{{seo_form.description.label}}</span>
                                {{ seo_form.description }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row mt-4">
            <div class="col-md-12 d-flex justify-content-center mt-5">
                <button type="submit" class="btn btn-primary">
                    {% if cinema_form.instance.pk %}Сохранить изменения{% else %}Создать{% endif %}
                </button>
            </div>
        </div>

    </div>










</form>


<script>
const cinemaId = "{{ cinema_form.instance.pk }}";
const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

const img = document.getElementById('mainImagePreview');
const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.accept = 'image/*';

document.getElementById('uploadMainImage').onclick = () => {
    fileInput.click();
};

fileInput.onchange = async () => {
    const file = fileInput.files[0];
    if (!file) return;

    img.src = URL.createObjectURL(file);

    const formData = new FormData();
    formData.append('file', file);

    await fetch(`/cinema/${cinemaId}/upload-image/main_image/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': csrfToken },
        body: formData
    });
};

document.getElementById('deleteMainImage').onclick = async () => {
    await fetch(`/cinema/${cinemaId}/delete-image/main_image/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': csrfToken }
    });

    img.src = 'https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673-960x960.png';
};

</script>









{% endblock%}